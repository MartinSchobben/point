<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IC-diagnostics • point</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="IC-diagnostics">
<meta property="og:description" content="point">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">point</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IC-diagnostics.html">IC-diagnostics</a>
    </li>
    <li>
      <a href="../articles/IC-introduction.html">IC-introduction</a>
    </li>
    <li>
      <a href="../articles/IC-precision.html">IC-precision</a>
    </li>
    <li>
      <a href="../articles/IC-process.html">IC-process</a>
    </li>
    <li>
      <a href="../articles/IC-read.html">IC-read</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>IC-diagnostics</h1>
                        <h4 class="author">Martin Schobben</h4>
            
      
      
      <div class="hidden name"><code>IC-diagnostics.Rmd</code></div>

    </div>

    
    
<div id="diagnostics-for-ion-count-data" class="section level1">
<h1 class="hasAnchor">
<a href="#diagnostics-for-ion-count-data" class="anchor"></a><span class="header-section-number">1</span> Diagnostics for Ion Count Data</h1>
<p>The random nature of secondary ions emitted from a sample is described by Poisson statistics, which can be used to predict the precision of SIMS measurements under ideal circumstances (e.g., the predicted standard error can be deduced from the total counts of secondary ions). However, besides this fundamental source of imprecision, real SIMS measurements are additionally affected by other factors such as sample heterogeneity, instrument instability, the development and geometry of the sputter pit, and sample charging. Although some of these biases can be avoided by proper instrument tuning and sample documentation (e.g. T/SEM to characterise the textural properties of a rock sample) prior to SIMS measurement, factors such as instrument instability or sample heterogeneity can never be fully eliminated. In this vignette, diagnostic tools are showcased which can help evaluate the potential impact of such factors on the precision of ion count data.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">point</span>)</pre></body></html></div>
<p>The following packages are used in the examples that follow.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">purrr</span>) <span class="co"># functional programming</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>) <span class="co"># manipulating data</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>) <span class="co"># graphics</span></pre></body></html></div>
<div id="nomenclature" class="section level2">
<h2 class="hasAnchor">
<a href="#nomenclature" class="anchor"></a><span class="header-section-number">1.1</span> Nomenclature</h2>
<ul>
<li>Sample: sample of the true population</li>
<li>Analytical substrate: Physical sample measured during SIMS analysis</li>
<li>Event: single event of an ion hitting the detector</li>
<li>Measurement: single count cycle <span class="math inline">\(N_i\)</span>
</li>
<li>Analysis: <span class="math inline">\(n\)</span>-series of measurements <span class="math inline">\(N_{(i)} = M_j\)</span>
</li>
<li>Study: <span class="math inline">\(m\)</span>-series of analyses <span class="math inline">\(M_{(j)}\)</span>, constituting the different spots on the analytical substrate</li>
</ul>
</div>
<div id="isotope-ratios-a-special-case" class="section level2">
<h2 class="hasAnchor">
<a href="#isotope-ratios-a-special-case" class="anchor"></a><span class="header-section-number">1.2</span> Isotope ratios: A special case</h2>
<p>Isotopes of the same element should have more-or-less the same ionization efficiency <span class="citation">(Fitzsimons, Harte, and Clark 2000)</span>. It thus follows, that in an isotopically homogeneous analytical substrate the count rates of two isotope from the same element should be dependent on each. From this it can be deduced that large deviations in count rate ratios of an isotope system between consecutive measurements indicate a potential discrepancy (e.g., sample heterogeneity and instrument instability).</p>
</div>
<div id="count-block-based-count-optimization-default-cameca-software-procedure" class="section level2">
<h2 class="hasAnchor">
<a href="#count-block-based-count-optimization-default-cameca-software-procedure" class="anchor"></a><span class="header-section-number">1.3</span> Count block based count optimization (Default Cameca software procedure)</h2>
<p>The default method to account for these discrepancies as incorporated in the Cameca software entails a blockwise check for variability. If values fall outside of a pre-defined range of variance (for example two standard deviations; named <span class="math inline">\(\sigma\)</span> in the Cameca software), the measurement will be rejected.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">
<span class="co"># Use point_example() to access the examples bundled with this package </span>

<span class="co"># Carry-out the routine point workflow</span>
<span class="co"># Raw data containing 13C and 12C counts on carbonate</span>
<span class="no">tb.rw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_IC.html">read_IC</a></span>(<span class="fu"><a href="../reference/point_example.html">point_example</a></span>(<span class="st">"2018-01-19-GLENDON"</span>))

<span class="co"># Processing raw ion count data</span>
<span class="no">tb.pr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cor_IC.html">cor_IC</a></span>(<span class="no">tb.rw</span>,
                <span class="kw">N</span> <span class="kw">=</span> <span class="no">N.rw</span>,
                <span class="kw">t</span> <span class="kw">=</span> <span class="no">t.rw</span>,
                <span class="kw">Det</span> <span class="kw">=</span> <span class="no">det_type.mt</span>,
                <span class="kw">deadtime</span> <span class="kw">=</span> <span class="fl">0</span>,
                <span class="kw">thr_PHD</span> <span class="kw">=</span> <span class="fl">0</span>)

<span class="co"># CAMECA style augmented datafile</span>
<span class="co"># Vectors of isotope ratios </span>
<span class="no">ion1</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"13C"</span>, <span class="st">"12C 13C"</span>, <span class="st">"13C 14N"</span>, <span class="st">"12C"</span>)
<span class="no">ion2</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"12C"</span>, <span class="st">"12C2"</span>, <span class="st">"12C 14N"</span>, <span class="st">"40Ca 16O"</span>)

<span class="co"># Call function Diag_R over all ion ratio combinations  </span>
<span class="no">tb.aug</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span>(<span class="no">ion1</span>, <span class="no">ion2</span>, ~(<span class="fu"><a href="../reference/diag_R.html">diag_R</a></span>(<span class="no">tb.pr</span>,
                                           <span class="kw">method</span> <span class="kw">=</span> <span class="st">"standard"</span>,
                                           <span class="kw">args</span> <span class="kw">=</span> <span class="fu"><a href="../reference/expr_R.html">expr_R</a></span>(<span class="kw">Xt</span> <span class="kw">=</span> <span class="st">"Xt.pr"</span>,
                                                         <span class="kw">N</span> <span class="kw">=</span> <span class="st">"N.pr"</span>,
                                                         <span class="kw">species</span> <span class="kw">=</span> <span class="st">"species.nm"</span>,
                                                         <span class="kw">ion1</span> <span class="kw">=</span> <span class="no">.x</span>,
                                                         <span class="kw">ion2</span> <span class="kw">=</span> <span class="no">.y</span>),
                                           <span class="no">file.nm</span>,
                                           <span class="no">bl.mt</span>) <span class="kw">%&gt;%</span>
                                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">flag</span> <span class="kw">==</span> <span class="st">"good"</span>)
                                    )
                      )

<span class="co"># Reproduce Cameca stat file: descriptive an predictive statistics for  </span>
<span class="co"># ratios (blockwise)</span>

<span class="co"># List variables</span>
<span class="no">ls.CAMECA</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">lst</a></span>(<span class="kw">df</span> <span class="kw">=</span> <span class="no">tb.aug</span>, <span class="kw">a</span> <span class="kw">=</span> <span class="no">ion1</span>, <span class="kw">b</span> <span class="kw">=</span> <span class="no">ion2</span>)

<span class="co"># Function to transform to calculate block wise and produce CAMECA output style</span>
<span class="no">fun_CAMECA</span> <span class="kw">&lt;-</span><span class="kw">function</span>(<span class="no">df</span>, <span class="no">a</span>, <span class="no">b</span>){

               <span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stat_Xt.html">stat_R</a></span>(<span class="no">df</span>, <span class="no">Xt.pr</span>, <span class="no">N.pr</span>, <span class="no">species.nm</span>,
                                            <span class="no">a</span>, <span class="no">b</span>, <span class="no">file.nm</span>, <span class="no">bl.mt</span>,
                                            <span class="kw">output</span> <span class="kw">=</span> <span class="st">"complete"</span>) <span class="kw">%&gt;%</span>
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">file.nm</span> <span class="kw">==</span> <span class="st">"2018-01-19-GLENDON_1_1"</span>) <span class="kw">%&gt;%</span>
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="no">bl.mt</span>, <span class="kw">.keep_all</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"meas_bl.mt"</span>)), ~(<span class="no">.</span> - <span class="no">n_R_Xt.pr</span>)) <span class="kw">%&gt;%</span>
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">`Err_mean (%)`</span> <span class="kw">=</span> <span class="no">RSeM_R_Xt.pr</span> / <span class="fl">10</span>,
                              <span class="kw">`Poisson (%)`</span> <span class="kw">=</span> <span class="no">hat_RSeM_R_Xt.pr</span> / <span class="fl">10</span>,
                              <span class="kw">`Ratio#`</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">a</span>, <span class="no">b</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"/"</span>)) <span class="kw">%&gt;%</span>
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">`Block#`</span> <span class="kw">=</span> <span class="no">bl.mt</span>,
                              <span class="no">`Ratio#`</span> ,
                              <span class="st">"Mean"</span> <span class="kw">=</span> <span class="no">M_R_Xt.pr</span>,
                              <span class="st">"SD"</span> <span class="kw">=</span> <span class="no">S_R_Xt.pr</span>,
                              <span class="kw">N_rej</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"meas_bl.mt"</span>)[<span class="fl">1</span>],
                              <span class="no">`Err_mean (%)`</span>,
                              <span class="no">`Poisson (%)`</span>,
                              <span class="st">"Khi2"</span> <span class="kw">=</span> <span class="no">chi2_R_Xt.pr</span>)
}

<span class="co"># Call the function</span>
<span class="no">tb.CAMECA</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_dfr</a></span>(<span class="no">ls.CAMECA</span>, <span class="no">fun_CAMECA</span>) <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">`Block#`</span>)</pre></body></html></div>
<div class="figure">
<span id="fig:xcpcameca"></span>
<img src="excerpt_stat.png" alt="An excerpt of the Cameca stat-file for count block based 2$\sigma$-rejection and associated blockwise statistics" width="90%"><p class="caption">
Figure 1.1: An excerpt of the Cameca stat-file for count block based 2<span class="math inline">\(\sigma\)</span>-rejection and associated blockwise statistics
</p>
</div>
<table class="table">
<caption>
<span id="tab:xcpcameca">Table 1.1: </span>Blockwise statistics for augmented dataset (replication of Fig.1).</caption>
<thead><tr class="header">
<th align="right">Block#</th>
<th align="left">Ratio#</th>
<th align="right">Mean</th>
<th align="right">SD</th>
<th align="right">N_rej</th>
<th align="right">Err_mean (%)</th>
<th align="right">Poisson (%)</th>
<th align="right">Khi2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">13C/12C</td>
<td align="right">0.011</td>
<td align="right">0.00085</td>
<td align="right">3</td>
<td align="right">1.00</td>
<td align="right">1.11</td>
<td align="right">0.81</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">12C 13C/12C2</td>
<td align="right">0.021</td>
<td align="right">0.00619</td>
<td align="right">2</td>
<td align="right">3.67</td>
<td align="right">3.96</td>
<td align="right">0.86</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">13C 14N/12C 14N</td>
<td align="right">0.016</td>
<td align="right">0.00513</td>
<td align="right">5</td>
<td align="right">4.25</td>
<td align="right">5.57</td>
<td align="right">0.58</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">12C/40Ca 16O</td>
<td align="right">3.887</td>
<td align="right">0.07454</td>
<td align="right">3</td>
<td align="right">0.24</td>
<td align="right">0.25</td>
<td align="right">0.92</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">13C/12C</td>
<td align="right">0.011</td>
<td align="right">0.00092</td>
<td align="right">1</td>
<td align="right">1.05</td>
<td align="right">1.09</td>
<td align="right">0.93</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">12C 13C/12C2</td>
<td align="right">0.022</td>
<td align="right">0.00600</td>
<td align="right">4</td>
<td align="right">3.50</td>
<td align="right">4.04</td>
<td align="right">0.75</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">13C 14N/12C 14N</td>
<td align="right">0.017</td>
<td align="right">0.00708</td>
<td align="right">1</td>
<td align="right">5.29</td>
<td align="right">5.41</td>
<td align="right">0.96</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">12C/40Ca 16O</td>
<td align="right">3.753</td>
<td align="right">0.07794</td>
<td align="right">4</td>
<td align="right">0.27</td>
<td align="right">0.25</td>
<td align="right">1.11</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">13C/12C</td>
<td align="right">0.011</td>
<td align="right">0.00081</td>
<td align="right">3</td>
<td align="right">0.95</td>
<td align="right">1.10</td>
<td align="right">0.74</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">12C 13C/12C2</td>
<td align="right">0.020</td>
<td align="right">0.00665</td>
<td align="right">2</td>
<td align="right">4.16</td>
<td align="right">4.23</td>
<td align="right">0.96</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">13C 14N/12C 14N</td>
<td align="right">0.016</td>
<td align="right">0.00708</td>
<td align="right">2</td>
<td align="right">5.73</td>
<td align="right">5.77</td>
<td align="right">0.98</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">12C/40Ca 16O</td>
<td align="right">3.655</td>
<td align="right">0.05899</td>
<td align="right">5</td>
<td align="right">0.21</td>
<td align="right">0.25</td>
<td align="right">0.69</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">13C/12C</td>
<td align="right">0.011</td>
<td align="right">0.00076</td>
<td align="right">3</td>
<td align="right">0.90</td>
<td align="right">1.10</td>
<td align="right">0.66</td>
</tr>
</tbody>
</table>
<p>Note, that in the above example of the Cameca diagnostics (Fig. <a href="#fig:xcpcameca">1.1</a>), ratios of none-isotope pairs have been calculated.</p>
<div class="figure">
<span id="fig:ion"></span>
<img src="IC-diagnostics_files/figure-html/ion-1.png" alt="The blockwise mean plotted against consecutive blocks. Note that the non-isotope ratios show a decreasing trend over time." width="768"><p class="caption">
Figure 1.2: The blockwise mean plotted against consecutive blocks. Note that the non-isotope ratios show a decreasing trend over time.
</p>
</div>
<p>Upon plotting the blockwise mean against the block number (Fig. <a href="#fig:ion">1.2</a>), it becomes apparent that the none-isotope ratios display a monotonic decreasing trend over the duration of the analysis. This effect likely reflects the differential ionization potentials and trajectories of secondary beam stabilization over the analysis.</p>
<p>Based on the Cameca <span class="math inline">\(\sigma\)</span>-rejection, it is possible to augment the dataset for each of the analyses by simply removing the anomalous measurements (<span class="math inline">\(N_i\)</span>), which pertains to the <span class="math inline">\(N\_rej\)</span> in Fig. <a href="#fig:xcpcameca">1.1</a>.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Augmented descriptive an predictive statistics (global dataset)</span>

<span class="co"># Function to transform to calculate block wise and produce CAMECA output style</span>
<span class="no">fun_CAMECA_gl</span> <span class="kw">&lt;-</span><span class="kw">function</span>(<span class="no">df</span>, <span class="no">a</span>, <span class="no">b</span>){

               <span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stat_Xt.html">stat_R</a></span>(<span class="no">df</span>, <span class="no">Xt.pr</span>, <span class="no">N.pr</span>, <span class="no">species.nm</span>,
                                            <span class="no">a</span>, <span class="no">b</span>, <span class="no">file.nm</span>,
                                            <span class="kw">output</span> <span class="kw">=</span> <span class="st">"complete"</span>) <span class="kw">%&gt;%</span>
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">file.nm</span> <span class="kw">==</span> <span class="st">"2018-01-19-GLENDON_1_1"</span>) <span class="kw">%&gt;%</span>

                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">`Err_mean (%)`</span> <span class="kw">=</span> <span class="no">RSeM_R_Xt.pr</span> / <span class="fl">10</span>,
                              <span class="kw">`Poisson (%)`</span> <span class="kw">=</span> <span class="no">hat_RSeM_R_Xt.pr</span> / <span class="fl">10</span>,
                              <span class="kw">`Ratio#`</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">a</span>, <span class="no">b</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"/"</span>),
                              <span class="kw">SD_bl</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">R_Xt.pr</span>) /
                                      <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">R_Xt.pr</span>) * <span class="fl">100</span>) <span class="kw">%&gt;%</span>
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="no">file.nm</span>, <span class="kw">.keep_all</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">`Ratio#`</span> ,
                              <span class="st">"Ratios"</span> <span class="kw">=</span> <span class="no">M_R_Xt.pr</span>,
                              <span class="no">`Poisson (%)`</span>,
                              <span class="no">`Err_mean (%)`</span>,
                              <span class="st">"Khi2"</span> <span class="kw">=</span> <span class="no">chi2_R_Xt.pr</span>,
                              <span class="kw">`SD_Block(%)`</span><span class="kw">=</span> <span class="no">SD_bl</span>)
}

<span class="co"># Call the function</span>
<span class="no">tb.CAMECA_aug</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_dfr</a></span>(<span class="no">ls.CAMECA</span>, <span class="no">fun_CAMECA_gl</span>)

<span class="co"># And the same without augmentation of the dataset</span>
<span class="no">ls.CAMECA</span>$<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ion1</span>), <span class="no">tb.pr</span>, <span class="kw">simplify</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">tb.CAMECA_org</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_dfr</a></span>(<span class="no">ls.CAMECA</span>, <span class="no">fun_CAMECA_gl</span>)</pre></body></html></div>
<div class="figure">
<span id="fig:xcpcameca2"></span>
<img src="excerpt_stat_global.png" alt="An excerpt of the Cameca stat-file for count block based 2$\sigma$-rejection and associated blockwise statistics" width="90%"><p class="caption">
Figure 1.3: An excerpt of the Cameca stat-file for count block based 2<span class="math inline">\(\sigma\)</span>-rejection and associated blockwise statistics
</p>
</div>
<table class="table">
<caption>
<span id="tab:aug">Table 1.2: </span>Summary stats for augmented dataset</caption>
<thead><tr class="header">
<th align="left">Ratio#</th>
<th align="right">Ratios</th>
<th align="right">Poisson (%)</th>
<th align="right">Err_mean (%)</th>
<th align="right">Khi2</th>
<th align="right">SD_Block(%)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">13C/12C</td>
<td align="right">0.011</td>
<td align="right">0.152</td>
<td align="right">0.14</td>
<td align="right">0.80</td>
<td align="right">8.3</td>
</tr>
<tr class="even">
<td align="left">12C 13C/12C2</td>
<td align="right">0.021</td>
<td align="right">0.850</td>
<td align="right">0.78</td>
<td align="right">0.83</td>
<td align="right">57.2</td>
</tr>
<tr class="odd">
<td align="left">13C 14N/12C 14N</td>
<td align="right">0.017</td>
<td align="right">1.114</td>
<td align="right">1.01</td>
<td align="right">0.83</td>
<td align="right">70.9</td>
</tr>
<tr class="even">
<td align="left">12C/40Ca 16O</td>
<td align="right">2.305</td>
<td align="right">0.029</td>
<td align="right">0.37</td>
<td align="right">162.36</td>
<td align="right">24.8</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>
<span id="tab:org">Table 1.3: </span>Summary stats for original dataset</caption>
<thead><tr class="header">
<th align="left">Ratio#</th>
<th align="right">Ratios</th>
<th align="right">Poisson (%)</th>
<th align="right">Err_mean (%)</th>
<th align="right">Khi2</th>
<th align="right">SD_Block(%)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">13C/12C</td>
<td align="right">0.011</td>
<td align="right">0.149</td>
<td align="right">0.15</td>
<td align="right">1.0</td>
<td align="right">9.3</td>
</tr>
<tr class="even">
<td align="left">12C 13C/12C2</td>
<td align="right">0.022</td>
<td align="right">0.819</td>
<td align="right">0.83</td>
<td align="right">1.0</td>
<td align="right">62.7</td>
</tr>
<tr class="odd">
<td align="left">13C 14N/12C 14N</td>
<td align="right">0.018</td>
<td align="right">1.054</td>
<td align="right">1.08</td>
<td align="right">1.1</td>
<td align="right">78.0</td>
</tr>
<tr class="even">
<td align="left">12C/40Ca 16O</td>
<td align="right">2.307</td>
<td align="right">0.028</td>
<td align="right">0.36</td>
<td align="right">163.4</td>
<td align="right">24.9</td>
</tr>
</tbody>
</table>
<p>However, when comparing the summary statistics of the augmented dataset (Table <a href="#tab:aug">1.2</a>) with the excerpt from the Cameca stat-file (Fig. <a href="#fig:xcpcameca2">1.3</a>) their seems to be a substantial difference. Instead upon comparison with Table <a href="#tab:org">1.3</a>, which consist of summary statistics calculated on the original dataset (without <span class="math inline">\(\sigma\)</span>-rejection of measurements), the replication is surprisingly consistent. This heralds the question whether their might be a mistake in the Cameca software for calculating statistics on ion ratios for complete analyses. Otherwise the blockwise <span class="math inline">\(\sigma\)</span>-rejection of measurements seems rather obfuscated, as it does not seem to serve an obvious purpose.</p>
</div>
<div id="regression-diagnostic-based-count-optimization" class="section level2">
<h2 class="hasAnchor">
<a href="#regression-diagnostic-based-count-optimization" class="anchor"></a><span class="header-section-number">1.4</span> Regression diagnostic based count optimization</h2>
<p>This will be included in future release.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Fitzsimons2000a">
<p>Fitzsimons, I. C. W., B. Harte, and R. M. Clark. 2000. “SIMS stable isotope measurement: counting statistics and analytical precision.” <em>Mineralogical Magazine</em> 64 (01): 59–83. <a href="https://doi.org/10.1180/002646100549139">https://doi.org/10.1180/002646100549139</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Martin Schobben.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
