<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="point">
<title>IC-diagnostics • point</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="IC-diagnostics">
<meta property="og:description" content="point">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">point</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/IC-diagnostics.html">IC-diagnostics</a>
    <a class="dropdown-item" href="../articles/IC-introduction.html">IC-introduction</a>
    <a class="dropdown-item" href="../articles/IC-precision.html">IC-precision</a>
    <a class="dropdown-item" href="../articles/IC-process.html">IC-process</a>
    <a class="dropdown-item" href="../articles/IC-read.html">IC-read</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>IC-diagnostics</h1>
                        <h4 data-toc-skip class="author">Martin Schobben</h4>
            
      
      
      <div class="d-none name"><code>IC-diagnostics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="diagnostics-for-ion-count-data">
<span class="header-section-number">1</span> Diagnostics for Ion Count Data<a class="anchor" aria-label="anchor" href="#diagnostics-for-ion-count-data"></a>
</h2>
<p>The random nature of secondary ions emitted from a sample is described by Poisson statistics, and can be used to predict the precision of SIMS measurements under ideal circumstances (e.g., the predicted standard error can be deduced from the total counts of secondary ions). However, besides this fundamental source of imprecision, real SIMS measurements are additionally affected by other factors such as sample heterogeneity, instrument instability, the development and geometry of the sputter pit, and sample charging. Although some of these biases can be avoided by proper instrument tuning and sample documentation (e.g. T/SEM to characterise the textural properties of a rock sample) prior to SIMS measurement, factors such as instrument instability or sample heterogeneity can never be fully eliminated. In this vignette, diagnostic tools are showcased which can help evaluate the potential impact of such factors on the precision of ion count data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://martinschobben.github.io/point/">point</a></span><span class="op">)</span></code></pre></div>
<p>The following packages are used in the examples that follow.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span> <span class="co"># functional programming</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># manipulating data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># graphics</span></code></pre></div>
<div class="section level3">
<h3 id="nomenclature">
<span class="header-section-number">1.1</span> Nomenclature<a class="anchor" aria-label="anchor" href="#nomenclature"></a>
</h3>
<ul>
<li>Sample: sample of the true population</li>
<li>Analytical substrate: physical sample measured during SIMS analysis</li>
<li>Event: single event of an ion hitting the detector</li>
<li>Measurement: single count cycle <span class="math inline">\(N_i\)</span>
</li>
<li>Analysis: <span class="math inline">\(n\)</span>-series of measurements <span class="math inline">\(N_{(i)} = M_j\)</span>
</li>
<li>Study: <span class="math inline">\(m\)</span>-series of analyses <span class="math inline">\(M_{(j)}\)</span>, constituting the different spots on the analytical substrate</li>
</ul>
</div>
<div class="section level3">
<h3 id="basic-functionality">
<span class="header-section-number">1.2</span> Basic functionality<a class="anchor" aria-label="anchor" href="#basic-functionality"></a>
</h3>
<p>The function <code><a href="../reference/diag_R.html">diag_R()</a></code> is designed to be a flexible wrapper for isotope count diagnostics. Non-isotope pairs are supported as well but the outcome is not necessarily meaningful due to variation caused by the ionization efficiency differences among elements, check the vignette <a href="IC-process.html">IC-process</a> for solutions. For basic functionality, <code><a href="../reference/diag_R.html">diag_R()</a></code> requires the following arguments: <code>.IC</code>, which should be a <a href="https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html" class="external-link">tibble</a> containing processed ion count data (ideally, following the routine <code>point</code> work-flow), and arguments <code>.ion1</code> and <code>.ion2</code> which link to the rare isotope and common isotope, respectively (as character strings). The dots <code>...</code> should be used to define a grouping variable to e.g. identify individual analysis or sets of analyses. The argument <code>.method</code> enables selection of diagnostic methods, which are outlined in this vignette. A range of other arguments dictate features of the returned statistics and plotting of the outcome (as a <a href="https://ggplot2.tidyverse.org/" class="external-link">ggplot</a>). Check <code>?diag_R()</code> for all options.</p>
<p>In the following example the grouping structure of the data frame is defined as the file-names and block numbers, which recreates the default Cameca<sup>TM</sup> software diagnostics.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use point_example() to access the examples bundled with this package </span>
<span class="co"># Carry-out the routine point work-flow</span>
<span class="co"># Raw data containing 13C and 12C counts on carbonate</span>
<span class="va">tb_rw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_IC.html">read_IC</a></span><span class="op">(</span><span class="fu"><a href="../reference/point_example.html">point_example</a></span><span class="op">(</span><span class="st">"2018-01-19-GLENDON"</span><span class="op">)</span>, meta <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Processing raw ion count data</span>
<span class="va">tb_pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cor_IC.html">cor_IC</a></span><span class="op">(</span><span class="va">tb_rw</span><span class="op">)</span>

<span class="co"># CAMECA style diagnostics</span>
<span class="va">tb_dia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_R.html">diag_R</a></span><span class="op">(</span><span class="va">tb_pr</span>, <span class="st">"13C"</span>, <span class="st">"12C"</span>, <span class="va">file.nm</span>, <span class="va">bl.nm</span>, .method <span class="op">=</span> <span class="st">"Cameca"</span>, 
                 .reps <span class="op">=</span> <span class="fl">2</span>,  .output <span class="op">=</span> <span class="st">"diagnostic"</span><span class="op">)</span> </code></pre></div>
<p>The output consist of a <code>tibble</code> containing the single ion count statistics for each ion and the isotope ratio statistics. In addition, the specific diagnostics (selected with <code>.method =  "Cameca"</code>) is appended to the tibble. Here the procedure was repeated two times (<code>.reps = 2</code>) and <code>.output</code> set to <code>"diagnostic"</code> to get the augmented summary statistics of <span class="math inline">\(R\)</span> following the Cameca<sup>TM</sup> output.</p>
</div>
</div>
<div class="section level2">
<h2 id="isotope-ratios-a-special-case">
<span class="header-section-number">2</span> Isotope ratios: A special case<a class="anchor" aria-label="anchor" href="#isotope-ratios-a-special-case"></a>
</h2>
<p>Isotopes of the same element should have more-or-less the same ionization efficiency <span class="citation">(Fitzsimons, Harte, and Clark 2000)</span>. It thus follows, that in an isotopically homogeneous analytical substrate the count rates of two isotope from the same element should be dependent on each. From this it can be deduced that large deviations in count rate ratios of an isotope system between consecutive measurements indicate a potential discrepancy (e.g., sample heterogeneity and instrument instability). This unique property enables the detection of situations in which the analysed substrate contains isotopic heterogeneity at a smaller scale than the beam size, or where machine instability causes a discrepancy in count rates between detectors.</p>
<div class="section level3">
<h3 id="count-block-based-diagnostics-camecatm">
<span class="header-section-number">2.1</span> Count block-based diagnostics (Cameca<sup>TM</sup>)<a class="anchor" aria-label="anchor" href="#count-block-based-diagnostics-camecatm"></a>
</h3>
<p>The default method to account for such discrepancies, as incorporated in the Cameca<sup>TM</sup> software, entails a block-wise (blocks represent sub-units of the complete analysis) check for variability. If values fall outside of a pre-defined range of variance (e.g. two standard deviations, referred to as <span class="math inline">\(\sigma\)</span> in the Cameca<sup>TM</sup> software), the measurement will be rejected (<span class="math inline">\(N\_rej\)</span> in the excerpt of the Cameca output files; Fig. <a href="#fig:xcpcameca">2.1</a>).</p>
<div class="figure">
<span style="display:block;" id="fig:xcpcameca"></span>
<img src="../reference/figures/excerpt_stat.png" alt="An excerpt of the Cameca stat-file for count block based 2$\sigma$-rejection and associated blockwise statistics" width="90%"><p class="caption">
Figure 2.1: An excerpt of the Cameca stat-file for count block based 2<span class="math inline">\(\sigma\)</span>-rejection and associated blockwise statistics
</p>
</div>
<table class="table">
<caption>
<span id="tab:unnamed-chunk-5">Table 2.1: </span>Blockwise statistics for augmented dataset (replication of Fig. <a href="#fig:xcpcameca">2.1</a> with the pointpackage).</caption>
<thead><tr class="header">
<th align="right">Block#</th>
<th align="left">Ratio#</th>
<th align="right">Mean</th>
<th align="right">SD</th>
<th align="right">N_rej</th>
<th align="right">Err_mean (%)</th>
<th align="right">Poisson (%)</th>
<th align="right">Khi2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2/1</td>
<td align="right">0.011</td>
<td align="right">0.00085</td>
<td align="right">3</td>
<td align="right">1.00</td>
<td align="right">1.11</td>
<td align="right">0.81</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">5/7</td>
<td align="right">0.110</td>
<td align="right">0.00671</td>
<td align="right">3</td>
<td align="right">0.77</td>
<td align="right">0.72</td>
<td align="right">1.16</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">1/7</td>
<td align="right">3.887</td>
<td align="right">0.07454</td>
<td align="right">3</td>
<td align="right">0.24</td>
<td align="right">0.25</td>
<td align="right">0.92</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">2/1</td>
<td align="right">0.011</td>
<td align="right">0.00092</td>
<td align="right">1</td>
<td align="right">1.05</td>
<td align="right">1.09</td>
<td align="right">0.93</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">5/7</td>
<td align="right">0.100</td>
<td align="right">0.00488</td>
<td align="right">5</td>
<td align="right">0.63</td>
<td align="right">0.75</td>
<td align="right">0.70</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">1/7</td>
<td align="right">3.753</td>
<td align="right">0.07794</td>
<td align="right">4</td>
<td align="right">0.27</td>
<td align="right">0.25</td>
<td align="right">1.11</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="regression-based-diagnostics">
<span class="header-section-number">2.2</span> Regression-based diagnostics<a class="anchor" aria-label="anchor" href="#regression-based-diagnostics"></a>
</h3>
<p>The solution provided by the Cameca<sup>TM</sup> software seems straightforward and effective, just compare the <span class="math inline">\(R\)</span> values of the individual measurements of an <span class="math inline">\(n\)</span>-series (<span class="math inline">\(N_{(i)}\)</span>), and check whether there are significant deviations at some points during the analysis. However, the situation is more complex than that, as illustrated with the following examples.</p>
<p>For these examples, isotope count rates have been simulated (<code>simu_IC</code> provide along with the package) for three hypothetical types of materials (Fig. <a href="#fig:simulations">2.2</a>).</p>
<ol style="list-style-type: decimal">
<li>An <strong>“ideal”</strong> substrate with a completely homogeneous isotopic composition<br>
</li>
<li>A substrate with a <strong>“symmetric gradient”</strong>, which has a isotope gradient spanning the whole depth covered by the analysis</li>
<li>A substrate with an <strong>“asymmetric gradient”</strong>, which has a sudden offset in isotope composition at a specific depth</li>
</ol>
<p>In the two simulations with a heterogeneous isotope composition the total span of isotope variability is set to 60‰. A linear trend is superimposed on the count rates of both isotope species, as this is an inherent phenomenon of SIMS analysis. This relates to changes in the ionization potential resulting from the sputter pit development and charge build-up (see vignette: <a href="IC-process.html">IC-process</a>). This <strong>systematic bias</strong> afflicts both isotope species to a similar degree thereby leaving <span class="math inline">\(R\)</span> unaltered <span class="citation">(see Fitzsimons, Harte, and Clark 2000)</span>.</p>
<div class="figure">
<span style="display:block;" id="fig:simulations"></span>
<img src="IC-diagnostics_files/figure-html/simulations-1.png" alt="Histograms comparing input and output $R$ values for simulations of an ideal isotopically homogenous material, a gradual gradient in $R$ (symmetric gradient), and a sudden shift in $R$ (asymmetric gradient)." width="1152"><p class="caption">
Figure 2.2: Histograms comparing input and output <span class="math inline">\(R\)</span> values for simulations of an ideal isotopically homogenous material, a gradual gradient in <span class="math inline">\(R\)</span> (symmetric gradient), and a sudden shift in <span class="math inline">\(R\)</span> (asymmetric gradient).
</p>
</div>
<p>From Figure <a href="#fig:simulations">2.2</a> it is evident that the real variation in <span class="math inline">\(R\)</span> (input R; black and red lines) are indistinguishable when viewing the derived distribution of the ion count ratios (output R; histogram). This is an effect related to the relative large <strong>random bias</strong> induced by the ionization of the substrate. So, even for these large variations in isotopic composition, it cannot be confidently said whether the measured <span class="math inline">\(R\)</span> is representative for the analysed site, or if the underlying data structure is skewed with one, or more, isotopically distinguishable components comprising the pooled <span class="math inline">\(R\)</span> value. This effect is, furthermore, hardly observable in the precision of the data, where the <span class="math inline">\(\epsilon_{\bar{R}}\)</span> of the simulation referred to as “asymmetric” is 1.01, 0.97, 0.97‰, whereas the “ideal” simulation has only a marginally better precision of 0.8, 0.79, 0.8‰.</p>
<p>From the previous examples, it becomes apparent that heterogeneous substrates cause minimal deviation in the internal precision. Hence, a lot of hidden variation in nominal SIMS isotope analyses can go undetected. So, clearly, a different approach must be adopted to identify these isotopically highly variable substrates.</p>
<div class="section level4">
<h4 id="linear-relationship-of-isotope-counts">
<span class="header-section-number">2.2.1</span> Linear relationship of isotope counts<a class="anchor" aria-label="anchor" href="#linear-relationship-of-isotope-counts"></a>
</h4>
<p>In an “ideal” isotopically homogeneous substrate the count rates of two isotope from the same element should be dependent on each other <span class="citation">(Fitzsimons, Harte, and Clark 2000)</span>. Thus, even though the ionization efficiency might vary within a single analysis, the count rate of an isotope species <span class="math inline">\(b\)</span> can be deduced from the count rate of isotope species <span class="math inline">\(a\)</span> through a linear combination with the isotope ratio <span class="math inline">\(R\)</span>:</p>
<p><span class="math display" id="eq:linmodR">\[\begin{equation}
\hat{X}_i^b = \hat{R}X_i^a +  \hat{e}_i \qquad \text{where} \quad  e_i \sim N \left(0,\sigma^2 \right) \tag{2.1}
\end{equation}\]</span></p>
<p>In this ideal linear count rate relationship, variation in <span class="math inline">\(R\)</span> is only caused by the random nature of secondary ion generation, which follows a Poisson distribution (see vignette <a href="IC-precision.html">IC-precision</a>). Instead of using Ordinary Least Squares (OLS) to obtain estimates for the regression coefficients, the ratio of mean ion count rates, or <span class="math inline">\(\bar{R}\)</span>, can be used as the single coefficient in this function (ratio estimation). Although the residuals (<span class="math inline">\(e_i\)</span>) of the linear model is unobserved, it can then be approximated, as follows:</p>
<p><span class="math display" id="eq:resR">\[\begin{equation}
 \hat{e}_i =  X_i^b - \hat{R}X_i^a \text{.} \tag{2.2}
\end{equation}\]</span></p>
<p>The component <span class="math inline">\(\hat{e}_i\)</span> gives a measure of the fit of the model (or the performance of this "ideal linear model) to the sampled data. This is known as residual analysis or regression diagnostics; see for example <span class="citation">(Fox and Weisberg 2018)</span>. Residual analysis yield estimates about the data points that could have unduly influenced the coefficient <span class="math inline">\(\hat{R}\)</span> of Equation <a href="#eq:linmodR">(2.1)</a>. Outliers detected in linear regression can therefore be described as an observation with a response variable (isotope species; <span class="math inline">\(X_i^b\)</span>) that is conditionally unusual when regarding the independent variable (isotope species; <span class="math inline">\(X_i^a\)</span>).</p>
<p>To demonstrate this we can use again <code><a href="../reference/diag_R.html">diag_R()</a></code> and the simulated data according to the previous specifications (“ideal”, “symmetric”, and “asymmetric” isotope variance), and supply the nominal arguments <code>.IC</code>, <code>.ion1</code>, <code>.ion2</code>, <code>...</code> to define again the ion count data, the isotope system to be analysed, as well as a grouping structure defining the individual analyses. We leave the <code>.method</code> as the default method, and plot the outcome with <code>.plot = TRUE</code>. The argument <code>.label</code> produces latex or webtex parsable labels for the data frame containing the statistics results.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tb_dia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_R.html">diag_R</a></span><span class="op">(</span><span class="va">simu_IC</span>, <span class="st">"13C"</span>, <span class="st">"12C"</span>, <span class="va">type.nm</span>, <span class="va">spot.nm</span>, .plot <span class="op">=</span> <span class="cn">TRUE</span>, 
                 .label <span class="op">=</span> <span class="st">"webtex"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:regression"></span>
<img src="IC-diagnostics_files/figure-html/regression-1.png" alt="Scatter-plot of ^13^C and ^12^C count rates and the regression line following equation \@ref(eq:linmodR) and with 2 times the predicted standard deviation of the ^13^C represented as the area around the regression line demarcated with dashed lines. Here the red points identify abnormal section of the analysis with many outliers." width="1152"><p class="caption">
Figure 2.3: Scatter-plot of <sup>13</sup>C and <sup>12</sup>C count rates and the regression line following equation <a href="#eq:linmodR">(2.1)</a> and with 2 times the predicted standard deviation of the <sup>13</sup>C represented as the area around the regression line demarcated with dashed lines. Here the red points identify abnormal section of the analysis with many outliers.
</p>
</div>
<p>The simulated scenarios in Fig. <a href="#fig:regression">2.3</a> visualise the comparison of the model following Eq. <a href="#eq:linmodR">(2.1)</a> and hypothetical bivariate <sup>13</sup>C-<sup>12</sup>C ion count rates. Anomalous sections of data-points about the model (red areas in Fig. <a href="#fig:regression">2.3</a>) can already be observed in the simulations of isotopically heterogeneous substrates merely by this visualization.</p>
<p>For more information and a validation of this method, see the preprint:</p>
<p><strong>Martin Schobben, Michiel Kienhuis, and Lubos Polerecky. 2021. New methods to detect isotopic heterogeneity with Secondary Ion Mass Spectrometry, preprint on <a href="https://eartharxiv.org/" class="external-link">Eartharxiv</a>.</strong></p>
</div>
<div class="section level4">
<h4 id="outlier-detection-cooks-d">
<span class="header-section-number">2.2.2</span> Outlier detection (Cook’s D)<a class="anchor" aria-label="anchor" href="#outlier-detection-cooks-d"></a>
</h4>
<p>The residuals will first be normalized to over come scale-dependence. This can be done by using the <em>studentized</em> residuals (<span class="math inline">\(\hat{e}_{i}^*\)</span>) <span class="citation">(see for example Fox and Weisberg 2018)</span>. A studentized residual is obtained by dividing the residual by an independent estimate of the standard deviation of the residuals. To ensure independence, the standard deviation of the residuals is calculated by leaving the residual of the <span class="math inline">\(i\)</span>-th observation out:</p>
<p><span class="math display" id="eq:studres">\[\begin{equation}
  \hat{e}_i^* = \frac{\hat{e}_i}{S_{\hat{e}_{(-i)}} \sqrt{(1-h_i)}} \text{,}
  \tag{2.3}
\end{equation}\]</span></p>
<p>where the standard error of the regression (standard deviation of the residuals) is also calculated by leaving the <span class="math inline">\(i\)</span>-th residual out:</p>
<p><span class="math display" id="eq:SEminusi">\[\begin{equation}
  S_{\hat{e}_{(-i)}} = \sqrt{\frac{1}{n-k-1} \sum_{i = 1}^{n}\hat{e}_i^2}
  \tag{2.4}
\end{equation}\]</span></p>
<p>In Eq. <a href="#eq:studres">(2.3)</a> <span class="math inline">\(h_i\)</span> represents the leverage of the independent variable (<span class="math inline">\(X^a\)</span>), or <em>hat-value</em>. The hat-value measures the distance from the mean of the independent variable <span class="math inline">\(X_i^a\)</span>:</p>
<p><span class="math display" id="eq:hatvalue">\[\begin{equation}
 h_i = \frac{1}{n} + \frac{ \left( X_i^a - \bar{X}_a \right)^2 }{\sum_{j=1}^n \left(X_j^a -  \bar{X}_a \right)^2}
 \tag{2.5}
\end{equation}\]</span></p>
<p>The larger the deviation <span class="math inline">\(X_i^a\)</span> from the mean (<span class="math inline">\(\bar{X}_a\)</span>) the more leverage the data-point has on the regression line. Given that the “ideal” simulation satisfies the conditions as initially described for the “ideal” linear model (Eq. <a href="#eq:linmodR">(2.1)</a>), the estimated <span class="math inline">\(\hat{e}\)</span> can be used to assess deviations from this “ideal linear model”, and thereby provide a measure of how representative the <span class="math inline">\(\bar{R}\)</span> is for the sampled spot. The goal of residual analysis would therefore be to identify the influence of the coefficient; in this case the influence on <span class="math inline">\(\bar{R}\)</span>, by determining the leverage and discrepancy (outlyingness) of variable <span class="math inline">\(X^a\)</span>, such that:</p>
<p><span class="math display" id="eq:influence">\[\begin{equation}
  \text{Influence} = \text{Leverage} + \text{Discrepancy}
    \tag{2.6}
\end{equation}\]</span></p>
<p>Having already determined the outlyingness; as the studentized residuals, and the leverage; as hat-values, of the independent variable, it is possible to determine the influence of <span class="math inline">\(X^a\)</span> have on the linear model (Eq. <a href="#eq:influence">(2.6)</a>). This influence can be quantified with <em>Cook’s Distance</em> (or <em>Cook’s D</em>). This formulation overcomes the effect that high leverage does not necessarily require the data-point to be influential, as <em>Cook’s D</em> combines the hat-values (Eq. <a href="#eq:hatvalue">(2.5)</a>) with studentized residuals (Eq. <a href="#eq:studres">(2.3)</a>), in a new equation:</p>
<p><span class="math display" id="eq:CD">\[\begin{equation}
  D_i = \frac{e_{i}^{*}\phantom{}^2}{k + 1} \times \frac{h_i}{1- h_i}
  \tag{2.7}
\end{equation}\]</span></p>
<p>Here, the <span class="math inline">\(k\)</span> stands for the number of coefficients in the regression model. To quantify whether <span class="math inline">\(D_i\)</span> is substantially larger then the rest of the sample’s <span class="math inline">\(D\)</span> a cut-off value can be defined as follows.</p>
<p><span class="math display" id="eq:CDcut">\[\begin{equation}
  D_c =4/ (n-k-1)
  \tag{2.8}
\end{equation}\]</span></p>
<p>These calculations are internally performed by a consecutive call to base <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> and <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">broom::augment()</a></code> <span class="citation">(Robinson, Hayes, and Couch 2022)</span>.</p>
</div>
<div class="section level4">
<h4 id="detecting-intra-analysis-isotope-varaibility-with-significant-outliers">
<span class="header-section-number">2.2.3</span> Detecting intra-analysis isotope varaibility with significant outliers<a class="anchor" aria-label="anchor" href="#detecting-intra-analysis-isotope-varaibility-with-significant-outliers"></a>
</h4>
<p>The effectiveness of recognising and differentiating the “ideal” substrate from compromised measurements detected with e.g. Cook’s D (or other outlier detection methods) can now be calculated by assessing the impact on the averaged <span class="math inline">\(R\)</span> value. This can be achieved by applying a joint model coefficient hypothesis test (or Fisher test), where the <code><a href="../reference/diag_R.html">diag_R()</a></code> function is designed to measure this deviation from the ideal “homogeneous” model (Eq. <a href="#eq:linmodR">(2.1)</a> by default.</p>
<p><span class="math display" id="eq:Fisher">\[\begin{equation}
F_{(q-p),(n-q)} = \frac{ (RSS_{\theta_{0}}-RSS_{\theta_{1}}) / (q-p) }{RSS_{\theta_{1}} / (n-q)} \tag{2.9}
\end{equation}\]</span></p>
<p>The default settings of the <code><a href="../reference/diag_R.html">diag_R()</a></code> function produces the following outcome.</p>
<table class="table">
<thead><tr class="header">
<th align="right">execution</th>
<th align="left">type.nm</th>
<th align="right">spot.nm</th>
<th align="left">ratio.nm</th>
<th align="right"><span class="math inline">\(\bar{R}\)</span></th>
<th align="right"><span class="math inline">\(F_{R}\)</span></th>
<th align="right"><span class="math inline">\(p_{R}\)</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">symmetric</td>
<td align="right">1</td>
<td align="left">13C/12C</td>
<td align="right">0.0110</td>
<td align="right">105</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">symmetric</td>
<td align="right">2</td>
<td align="left">13C/12C</td>
<td align="right">0.0110</td>
<td align="right">127</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">symmetric</td>
<td align="right">3</td>
<td align="left">13C/12C</td>
<td align="right">0.0110</td>
<td align="right">122</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">asymmetric</td>
<td align="right">1</td>
<td align="left">13C/12C</td>
<td align="right">0.0111</td>
<td align="right">63</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">asymmetric</td>
<td align="right">2</td>
<td align="left">13C/12C</td>
<td align="right">0.0111</td>
<td align="right">75</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">asymmetric</td>
<td align="right">3</td>
<td align="left">13C/12C</td>
<td align="right">0.0111</td>
<td align="right">72</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">ideal</td>
<td align="right">1</td>
<td align="left">13C/12C</td>
<td align="right">0.0112</td>
<td align="right">0</td>
<td align="right">0.85</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">ideal</td>
<td align="right">2</td>
<td align="left">13C/12C</td>
<td align="right">0.0112</td>
<td align="right">0</td>
<td align="right">0.88</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">ideal</td>
<td align="right">3</td>
<td align="left">13C/12C</td>
<td align="right">0.0112</td>
<td align="right">2</td>
<td align="right">0.16</td>
</tr>
</tbody>
</table>
<p>Here, the <span class="math inline">\(F_{R}\)</span> refers to the Fisher test statistic and the associated significance value as <span class="math inline">\(p_{R}\)</span>.</p>
<p>Sensitivity runs (outlined in Schobben, Kienhuis and Polerecky, in prep) show that the Cook’s D outlier detection method performs best when compared to other methods. Hence, problematic analyses with possible intra-analysis isotope variability can be detected, even if this is not obvious from the descriptive and predictive statistics alone.</p>
</div>
</div>
<div class="section level3">
<h3 id="inter-analysis-isotope-variability">
<span class="header-section-number">2.3</span> Inter-analysis isotope variability<a class="anchor" aria-label="anchor" href="#inter-analysis-isotope-variability"></a>
</h3>
<p>The <code><a href="../reference/diag_R.html">diag_R()</a></code> is designed in resemblance to the <code><a href="../reference/stat_X.html">stat_R()</a></code> function, and thus also includes an option to check the external structure of the the <span class="math inline">\(m\)</span>-series of analyses usually comprised in a SIMS-based study (i.e. severeal sputter pits). For this purpose, again an <code>.nest</code> argument is included to define the grouping structure of individual analysis. In the simulated example this could refer to the different scenarios of isotopic variations (“ideal”, “symmetric”, and “asymmetric” isotope variance). And, this then provides a test for inter-analysis isotope variability (among the sputter pits), and can be conducted as follows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tb_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diag_R.html">diag_R</a></span><span class="op">(</span><span class="va">simu_IC</span>, <span class="st">"13C"</span>, <span class="st">"12C"</span>, <span class="va">type.nm</span>, <span class="va">spot.nm</span>, .nest <span class="op">=</span> <span class="va">type.nm</span>, 
                 .label <span class="op">=</span> <span class="st">"webtex"</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="7%">
<col width="5%">
<col width="6%">
<col width="6%">
<col width="5%">
<col width="5%">
<col width="10%">
<col width="20%">
<col width="15%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="right">execution</th>
<th align="left">type.nm</th>
<th align="right">spot.nm</th>
<th align="left">ratio.nm</th>
<th align="right"><span class="math inline">\(\bar{R}\)</span></th>
<th align="right"><span class="math inline">\(F_{R}\)</span></th>
<th align="right"><span class="math inline">\(p_{R}\)</span></th>
<th align="right"><span class="math inline">\(\hat{\bar{R}}\)</span></th>
<th align="right">
<span class="math inline">\(\hat{\epsilon}_{\bar{R}}\)</span> (‰)</th>
<th align="right"><span class="math inline">\(\Delta AIC_{\bar{R}}\)</span></th>
<th align="right"><span class="math inline">\(p_{\bar{R}}\)</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">symmetric</td>
<td align="right">1</td>
<td align="left">13C/12C</td>
<td align="right">0.0110</td>
<td align="right">105</td>
<td align="right">0.00</td>
<td align="right">0.0111</td>
<td align="right">14.7</td>
<td align="right">606</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">symmetric</td>
<td align="right">2</td>
<td align="left">13C/12C</td>
<td align="right">0.0110</td>
<td align="right">127</td>
<td align="right">0.00</td>
<td align="right">0.0111</td>
<td align="right">14.3</td>
<td align="right">592</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">symmetric</td>
<td align="right">3</td>
<td align="left">13C/12C</td>
<td align="right">0.0110</td>
<td align="right">122</td>
<td align="right">0.00</td>
<td align="right">0.0111</td>
<td align="right">14.3</td>
<td align="right">595</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">asymmetric</td>
<td align="right">1</td>
<td align="left">13C/12C</td>
<td align="right">0.0111</td>
<td align="right">63</td>
<td align="right">0.00</td>
<td align="right">0.0111</td>
<td align="right">14.7</td>
<td align="right">606</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">asymmetric</td>
<td align="right">2</td>
<td align="left">13C/12C</td>
<td align="right">0.0111</td>
<td align="right">75</td>
<td align="right">0.00</td>
<td align="right">0.0111</td>
<td align="right">14.3</td>
<td align="right">592</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">asymmetric</td>
<td align="right">3</td>
<td align="left">13C/12C</td>
<td align="right">0.0111</td>
<td align="right">72</td>
<td align="right">0.00</td>
<td align="right">0.0111</td>
<td align="right">14.3</td>
<td align="right">595</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">ideal</td>
<td align="right">1</td>
<td align="left">13C/12C</td>
<td align="right">0.0112</td>
<td align="right">0</td>
<td align="right">0.85</td>
<td align="right">0.0111</td>
<td align="right">14.7</td>
<td align="right">606</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">ideal</td>
<td align="right">2</td>
<td align="left">13C/12C</td>
<td align="right">0.0112</td>
<td align="right">0</td>
<td align="right">0.88</td>
<td align="right">0.0111</td>
<td align="right">14.3</td>
<td align="right">592</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">ideal</td>
<td align="right">3</td>
<td align="left">13C/12C</td>
<td align="right">0.0112</td>
<td align="right">2</td>
<td align="right">0.16</td>
<td align="right">0.0111</td>
<td align="right">14.3</td>
<td align="right">595</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>This test provides and approximation of the “grand mean” (<span class="math inline">\(\bar{\bar{R}} = \frac{1}{m}\sum_{j =1}^{m}\bar{R}_j\)</span>) of the study <span class="math inline">\(\hat{\bar{R}}\)</span>. If the substrate would be isotopically homogeneous across its surface, then each analysis would approach <span class="math inline">\(\bar{\bar{R}}\)</span>. This can again be described by the ideal “homogeneous” model of Equation <a href="#eq:linmodR">(2.1)</a>, where the <span class="math inline">\(m\)</span>-series is viewed as one long analysis of <span class="math inline">\(n\)</span>-measurements (<span class="math inline">\(m\sum_{i=1}^{n}X_{i}^{a \mid b}\)</span>). Introduction of a nominal factorial that interacts with <span class="math inline">\(\hat{R}\)</span> can therefore again be used, but now to account for inter-analysis isotope variability. The major difference of this approach is that in this case the levels are encoded to represent the <span class="math inline">\(j\)</span>-th analysis of the <span class="math inline">\(m\)</span>-series of analyses. Encoding of this nominal variable can in theory constitute as many analyses as needed, potentially creating excessive parameters when considered as a fix component. This grouping structure, that is of no particular interest, is therefore instead represented as a random effect. This introduces a second level in Equation <a href="#eq:linmodR">(2.1)</a>, where each group (<span class="math inline">\(j\)</span>-th analysis) can assume a different <span class="math inline">\(\hat{R}\)</span>, that is, different <span class="math inline">\(\bar{R}\)</span> may exist among the various analysis.</p>
<p><span class="math display">\[\begin{equation}
 \text{level 1:} \quad \hat{X}_{ij}^b = \hat{R}_{j}X_{ij}^a +  e_{ij} \qquad \text{where} \quad  e_{ij} \sim N(0,\sigma^2)   
\end{equation}\]</span></p>
<p><span class="math display" id="eq:mlm">\[\begin{equation}
\text{level 2:} \quad \hat{R}_{j} = \hat{\bar{R}} + u_{j} \qquad \text{where} \quad u_{j} \sim N(0, t^2) \tag{2.10}
\end{equation}\]</span></p>
<p>Coefficients for this mixed linear model are obtained by Restricted Maximum Likelihood (REML) optimization using the <code>lme()</code> function of the <code>nlme</code> package <span class="citation">(Pinheiro, Bates, and R Core Team 2022)</span>. The ratio of the obtained log-likelihood (i.e., maximized likelihood functions) for the restricted model and the unrestricted model, or likelihood-ratio test (LR), can the be applied to deduce the significance of including a random component in Equation <a href="#eq:linmodR">(2.1)</a>. Here, a larger difference in the AIC (<span class="math inline">\(\Delta AIC_{\bar{R}}\)</span>) and thus lower <span class="math inline">\(p_{\bar{R}}\)</span> indicates that the null model of no inter-analysis isotope variability becomes less appropriate.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-Fitzsimons2000a">
<p>Fitzsimons, I. C. W., B. Harte, and R. M. Clark. 2000. “SIMS stable isotope measurement: counting statistics and analytical precision.” <em>Mineralogical Magazine</em> 64 (01): 59–83. <a href="https://doi.org/10.1180/002646100549139" class="external-link">https://doi.org/10.1180/002646100549139</a>.</p>
</div>
<div id="ref-Fox2018">
<p>Fox, John, and Sanford Weisberg. 2018. <em>An R companion to applied regression</em>. Sage publications.</p>
</div>
<div id="ref-nlme">
<p>Pinheiro, José, Douglas Bates, and R Core Team. 2022. <em>Nlme: Linear and Nonlinear Mixed Effects Models</em>. <a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">https://svn.r-project.org/R-packages/trunk/nlme/</a>.</p>
</div>
<div id="ref-broom">
<p>Robinson, David, Alex Hayes, and Simon Couch. 2022. <em>Broom: Convert Statistical Objects into Tidy Tibbles</em>. <a href="https://CRAN.R-project.org/package=broom" class="external-link">https://CRAN.R-project.org/package=broom</a>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martin Schobben.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
